<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BongoWide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        // --- TAILWIND CONFIGURATION & THEME LOGIC ---
        
        // 1. Theme State (Default)
        const themeConfig = {
            mode: localStorage.getItem('theme-mode') || 'light', // 'light' or 'dark'
            color: localStorage.getItem('theme-color') || 'blue-600', // Default color
        };

        // Rangi zilizopo za kuchagua
        const colorOptions = [
            'blue-600', 'green-500', 'purple-600', 'orange-500', 'red-600'
        ];

        // Function ya ku-resolve color class
        function getColorClass(color) {
            switch(color) {
                case 'green-500': return '#22c55e';
                case 'purple-600': return '#9333ea';
                case 'orange-500': return '#f97316';
                case 'red-600': return '#dc2626';
                default: return '#2563eb'; // blue-600
            }
        }

        // 2. Dynamic Tailwind Config
        tailwind.config = {
            darkMode: 'class', // We use the 'dark' class on the HTML tag
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        // Primary color uses the dynamic theme color
                        primary: {
                            // Hii itatumia CSS variable kwa updates za haraka
                            DEFAULT: 'var(--tw-primary-color, #2563eb)', 
                            foreground: "#ffffff",
                        },
                        secondary: {
                            DEFAULT: "#f1f5f9",
                            foreground: "#0f172a",
                        },
                        // Custom dark mode colors
                        'dark-bg': '#111827',
                        'dark-surface': '#1f2937',
                        'dark-text': '#f3f4f6',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Body default state */
        body { background-color: #f8fafc; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Dark Mode overrides */
        .dark { color-scheme: dark; }
        .dark body { background-color: #000000; color: #f3f4f6; } 
        .dark .bg-white { background-color: #1a1a1a !important; color: #f3f4f6; } 
        .dark .bg-slate-50 { background-color: #000000 !important; } 
        .dark .bg-slate-200 { background-color: #333333 !important; }
        .dark .text-slate-900 { color: #f3f4f6 !important; }
        .dark .text-slate-500, .dark .text-slate-600 { color: #aaaaaa !important; }
        .dark .border-b, .dark .border-t, .dark .divide-y, .dark .border { border-color: #333333 !important; }
        .dark .hover\:bg-slate-50:hover { background-color: #0d0d0d !important; }
        .dark .hover\:bg-slate-100:hover { background-color: #333333 !important; }
        
        /* Primary color variable for dynamic updates */
        :root {
            --tw-primary-color: #2563eb;
        }
    </style>
</head>

<body class="text-slate-900">

    <header id="app-header" class="flex h-16 shrink-0 items-center justify-between border-b bg-white px-4 shadow-sm z-20">
        <h1 class="text-2xl font-bold" style="color: var(--tw-primary-color);">BongoWide</h1>
        <div class="flex items-center gap-2">
            <button class="p-2 rounded-full hover:bg-slate-100 text-slate-600">
                <i class="fas fa-bell text-lg"></i>
            </button>
            <button id="theme-toggle-btn" class="p-2 rounded-full hover:bg-slate-100 text-slate-600 relative">
                <i class="fas fa-palette text-lg"></i> 
            </button>
            <button class="p-2 rounded-full hover:bg-slate-100 text-slate-600">
                <i class="fas fa-search text-lg"></i>
            </button>
            <button onclick="switchTab('Settings')" class="ml-1 h-8 w-8 rounded-full bg-slate-200 overflow-hidden border border-slate-300 flex items-center justify-center font-bold text-sm">
                KC
            </button>
        </div>
    </header>

    <main id="app-content" class="flex-1 overflow-hidden relative bg-slate-50">
    </main>

    <nav id="app-nav" class="flex h-16 items-center justify-around border-t bg-white z-20">
        <button onclick="switchTab('Chats')" id="nav-Chats" class="nav-btn flex h-full flex-1 flex-col items-center justify-center gap-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">
            <i class="fas fa-comment-alt text-xl mb-1"></i>
            <span>Chats</span>
        </button>
        <button onclick="switchTab('Updates')" id="nav-Updates" class="nav-btn flex h-full flex-1 flex-col items-center justify-center gap-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">
            <i class="fas fa-rss text-xl mb-1"></i>
            <span>Updates</span>
        </button>
        <button onclick="switchTab('Groups')" id="nav-Groups" class="nav-btn flex h-full flex-1 flex-col items-center justify-center gap-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">
            <i class="fas fa-users text-xl mb-1"></i>
            <span>Groups</span>
        </button>
        <button onclick="switchTab('World')" id="nav-World" class="nav-btn flex h-full flex-1 flex-col items-center justify-center gap-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">
            <i class="fas fa-globe text-xl mb-1"></i>
            <span>World</span>
        </button>
        <button onclick="switchTab('Calls')" id="nav-Calls" class="nav-btn flex h-full flex-1 flex-col items-center justify-center gap-1 text-xs text-slate-500 hover:text-blue-600 transition-colors">
            <i class="fas fa-phone text-xl mb-1"></i>
            <span>Calls</span>
        </button>
    </nav>
    
    <div id="theme-modal" class="absolute top-16 right-4 z-50 hidden">
        </div>


    <script>
        // --- 1. MOCK DATA ---
        
        const mockChats = [
            { id: 1, name: "Juma Jux", type: 'private', avatarUrl: "https://i.pravatar.cc/150?u=1", unreadCount: 2, messages: [{ text: "Mambo vipi kaka?", timestamp: "10:30 AM" }] },
            { id: 2, name: "Wazee wa Bongo", type: 'group', avatarUrl: "https://i.pravatar.cc/150?u=2", unreadCount: 0, messages: [{ text: "Kikao kipo leo?", timestamp: "Yesterday" }] },
            { id: 3, name: "Anita", type: 'private', avatarUrl: "https://i.pravatar.cc/150?u=3", unreadCount: 5, messages: [{ text: "Call me ASAP", timestamp: "Yesterday" }] },
            { id: 4, name: "Tech Talk TZ", type: 'group', avatarUrl: "https://i.pravatar.cc/150?u=4", unreadCount: 10, messages: [{ text: "New React version released", timestamp: "2 days ago" }] }
        ];

        const mockStatusUpdates = [
            { id: 1, viewed: false, user: { name: "Ben", avatarUrl: "https://i.pravatar.cc/150?u=7" } },
            { id: 2, viewed: true, user: { name: "Alice", avatarUrl: "https://i.pravatar.cc/150?u=8" } },
            { id: 3, viewed: false, user: { name: "John", avatarUrl: "https://i.pravatar.cc/150?u=9" } },
        ];
        
        const mockFriendRequests = [
            { id: 1, name: "Alex Doe", age: 28, gender: 'Male', time: 'about 3 hours ago', avatarUrl: "https://i.pravatar.cc/150?u=alex" },
            { id: 2, name: "Samantha Bee", age: 25, gender: 'Female', time: '1 day ago', avatarUrl: "https://i.pravatar.cc/150?u=samantha" },
        ];

        const mockCallContacts = [
            { id: 1, name: "Kelvin Kelvin Amos Charles", avatarUrl: "https://i.pravatar.cc/150?u=kelvin" },
            { id: 2, name: "Jedo Mavimba", avatarUrl: "https://i.pravatar.cc/150?u=jedo" },
            { id: 3, name: "Felicia John", avatarUrl: "https://i.pravatar.cc/150?u=felicia" },
            { id: 4, name: "Saniya Cutebaby", avatarUrl: "https://i.pravatar.cc/150?u=saniya" },
        ];


        // --- 2. SCREEN RENDERERS ---

        // NEW: SETTINGS SCREEN RENDERER (Kama picha ya pili ulivyoomba mwanzo)
        function getSettingsScreen() {
            const userProfile = { name: "Kelvin Charles", avatarUrl: "https://i.pravatar.cc/150?u=me" };

            const settingsItems = [
                { icon: 'fas fa-key', title: 'Account', subtitle: 'Security notifications, change number', action: 'account' },
                { icon: 'fas fa-lock', title: 'Privacy', subtitle: 'Block contacts, disappearing messages', action: 'privacy' },
                { icon: 'fas fa-smile', title: 'Avatar', subtitle: 'Create, edit, profile photo', action: 'avatar' },
                { icon: 'fas fa-comment-dots', title: 'Chats', subtitle: 'Theme, wallpapers, chat history', action: 'chats' },
                { icon: 'fas fa-bell', title: 'Notifications', subtitle: 'Message, group & call tones', action: 'notifications' },
                { icon: 'fas fa-database', title: 'Storage and data', subtitle: 'Network usage, auto-download', action: 'storage' },
                { icon: 'fas fa-sign-out-alt', title: 'Logout', isLogout: true, action: 'logout' },
            ];
            
            // Re-render the primary color using CSS variable
            const primaryColor = `var(--tw-primary-color)`;

            const settingsHtml = settingsItems.map(item => `
                <div onclick="${item.isLogout ? 'alert(\'Logging out...\')' : 'alert(\'Go to ' + item.title + '\')'}" class="flex items-center gap-4 p-4 transition-colors hover:bg-slate-50 cursor-pointer">
                    <div class="w-8 h-8 flex items-center justify-center text-xl" style="color: ${item.isLogout ? 'red' : primaryColor};">
                        <i class="${item.icon}"></i>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <h3 class="font-medium ${item.isLogout ? 'text-red-500' : 'text-slate-900'}">${item.title}</h3>
                        ${item.subtitle ? `<p class="text-sm text-slate-500">${item.subtitle}</p>` : ''}
                    </div>
                    ${!item.isLogout ? '<i class="fas fa-chevron-right text-slate-400 text-sm"></i>' : ''}
                </div>
            `).join('');


            return `
                <div class="h-full overflow-y-auto bg-slate-50">
                    <header class="h-16 flex items-center px-4 bg-white border-b border-slate-100">
                        <button onclick="switchTab('Chats')" class="p-2 mr-4 text-slate-600 hover:bg-slate-100 rounded-full">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h2 class="text-xl font-semibold text-slate-900">Settings</h2>
                        <button class="ml-auto p-2 text-slate-600 hover:bg-slate-100 rounded-full">
                            <i class="fas fa-search"></i>
                        </button>
                    </header>
                    
                    <div class="flex items-center gap-4 p-4 mt-2 bg-white border-b border-t border-slate-100 cursor-pointer hover:bg-slate-50">
                        <div class="h-14 w-14 rounded-full bg-slate-200 overflow-hidden border border-slate-300 flex items-center justify-center text-lg font-bold">
                             KC
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-slate-900">${userProfile.name}</h3>
                            <p class="text-sm text-slate-500">Hey there! I'm using BongoWide.</p>
                        </div>
                        <i class="fas fa-qrcode text-2xl" style="color: ${primaryColor};"></i>
                    </div>

                    <div class="bg-white divide-y divide-slate-100 mt-4 shadow-sm pb-12 border-t border-b border-slate-100">
                        ${settingsHtml}
                    </div>

                </div>
            `;
        }

        // Other screens (Chats, Updates, Groups, World, Calls) zimebaki kama kwenye jibu lililopita
        // Ili kupunguza urefu, nitaweka mfano wa Chats screen tu.

        function getChatsScreen() {
            const chatsHtml = mockChats.map(chat => `
                <div class="flex items-center gap-4 p-4 transition-colors hover:bg-white border-b border-slate-100 cursor-pointer">
                    <div class="relative">
                        <img src="${chat.avatarUrl}" alt="${chat.name}" class="h-12 w-12 rounded-full object-cover">
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <h3 class="truncate font-semibold text-slate-900">${chat.name}</h3>
                        <p class="truncate text-sm text-slate-500">
                            ${chat.messages[0]?.text || "No messages"}
                        </p>
                    </div>
                    <div class="flex flex-col items-end gap-1 text-xs text-slate-500">
                        <span>${chat.messages[0]?.timestamp || ""}</span>
                        ${chat.unreadCount > 0 ? `<span class="text-white px-2 py-0.5 rounded-full text-[10px]" style="background-color: var(--tw-primary-color);">${chat.unreadCount}</span>` : ''}
                    </div>
                </div>
            `).join('');

            return `
                <div class="relative h-full bg-white">
                    <div class="h-full overflow-y-auto divide-y divide-border pb-20">
                        ${chatsHtml}
                    </div>
                    <button class="absolute bottom-6 right-6 h-14 w-14 rounded-full shadow-lg text-white flex items-center justify-center hover:opacity-90 transition-transform active:scale-95" style="background-color: var(--tw-primary-color);">
                        <i class="fas fa-comment-medical text-xl"></i>
                    </button>
                </div>
            `;
        }
        
        // ... (Weka functions zote za getGroupsScreen, getUpdatesScreen, getWorldScreen, getCallsScreen hapa) ...
        
        function getGroupsScreen() {
            // Re-use logic from previous response
             return `
                <div class="flex flex-col items-center justify-center h-full text-center p-8 bg-white">
                    <i class="fas fa-users text-4xl text-slate-300 mb-4"></i>
                    <h2 class="text-xl font-semibold">Groups Screen</h2>
                    <p class="text-slate-500 mt-2">Create a group to start chatting.</p>
                </div>
            `;
        }

        function getUpdatesScreen() {
            // Re-use logic from previous response
             return `
                <div class="relative h-full overflow-y-auto bg-slate-50">
                    <div class="p-4 space-y-8 pb-20">
                        <div>
                            <h2 class="text-xl font-bold mb-4">Mood</h2>
                            <div class="bg-white p-4 rounded-lg shadow-sm w-40 h-40 flex flex-col items-center justify-center border border-slate-200 cursor-pointer">
                                <div class="h-16 w-16 rounded-full bg-slate-200 flex items-center justify-center text-slate-900 font-bold text-xl relative">
                                    KC
                                    <div class="absolute bottom-0 right-0 h-6 w-6 rounded-full bg-green-500 text-white flex items-center justify-center border-2 border-white">
                                        <i class="fas fa-plus text-xs"></i>
                                    </div>
                                </div>
                                <span class="mt-3 text-sm font-medium text-slate-500">Add mood</span>
                            </div>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold mb-4">Posts za Hivi Karibuni</h2>
                            <div class="bg-white p-8 rounded-lg shadow-sm h-48 flex items-center justify-center border border-slate-200">
                                <p class="text-slate-500">Recent posts will appear here</p>
                            </div>
                        </div>
                    </div>
                    <button class="absolute bottom-6 right-6 h-14 w-14 rounded-full shadow-lg text-white flex items-center justify-center transition-transform active:scale-95" style="background-color: var(--tw-primary-color);">
                        <i class="fas fa-plus text-xl"></i>
                    </button>
                </div>
            `;
        }

        function getWorldScreen() {
            // Re-use logic from previous response
            const requestHtml = mockFriendRequests.map(request => `
                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 p-4 border-b border-slate-100 bg-white">
                    <div class="h-16 w-16 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden shrink-0">
                        <img src="${request.avatarUrl}" alt="${request.name}" class="h-full w-full object-cover">
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <div class="flex justify-between items-start w-full">
                            <h3 class="truncate font-semibold text-slate-900">${request.name}</h3>
                            <span class="text-xs text-slate-500 whitespace-nowrap">${request.time}</span>
                        </div>
                        <p class="text-sm text-slate-500">${request.age} years old â€¢ ${request.gender}</p>
                        <div class="flex gap-2 mt-3 w-full sm:w-auto">
                            <button class="flex-1 sm:flex-none px-4 py-2 text-white rounded-md font-medium hover:opacity-90 transition-colors active:scale-95" style="background-color: var(--tw-primary-color);">
                                Confirm
                            </button>
                            <button class="flex-1 sm:flex-none px-4 py-2 bg-slate-200 text-slate-900 rounded-md font-medium hover:bg-slate-300 transition-colors active:scale-95">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            return `
                <div class="relative h-full bg-slate-50 overflow-y-auto">
                    <div class="p-4 border-b bg-white flex justify-start space-x-6">
                        <button class="px-1 py-1 font-semibold border-b-2 text-blue-600" style="border-color: var(--tw-primary-color); color: var(--tw-primary-color);">
                            Friends
                        </button>
                        <button class="px-1 py-1 font-semibold text-slate-500 hover:text-blue-600 hover:border-b-2 hover:border-slate-200 transition-colors">
                            Partners
                        </button>
                    </div>
                    
                    <div class="p-4">
                        <h2 class="text-lg font-semibold mb-3">Friend Requests (${mockFriendRequests.length})</h2>
                        <div class="rounded-lg shadow-sm overflow-hidden border border-slate-100 divide-y divide-slate-100">
                            ${requestHtml}
                        </div>
                    </div>

                    <div class="flex flex-col items-center justify-center h-32 mt-4 bg-white mx-4 rounded-lg shadow-sm border border-slate-100">
                        <p class="text-slate-500 text-sm">Your current friends will appear here.</p>
                    </div>
                </div>
            `;
        }

        function getCallsScreen() {
             // Re-use logic from previous response
            const callContactsHtml = mockCallContacts.map(contact => `
                <div class="flex items-center gap-4 p-3 border-b border-slate-100 bg-white hover:bg-slate-50 cursor-pointer">
                    <div class="h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center overflow-hidden shrink-0">
                        <img src="${contact.avatarUrl}" alt="${contact.name}" class="h-full w-full object-cover">
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <h3 class="truncate font-medium text-slate-900">${contact.name}</h3>
                    </div>
                    <button class="h-8 w-8 rounded-full hover:bg-slate-100 flex items-center justify-center" style="color: var(--tw-primary-color);">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="h-8 w-8 rounded-full hover:bg-slate-100 flex items-center justify-center" style="color: var(--tw-primary-color);">
                        <i class="fas fa-video"></i>
                    </button>
                </div>
            `).join('');

            return `
                <div class="relative h-full overflow-y-auto bg-slate-50">
                    <div class="p-4 space-y-6 pb-20">
                        
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-100 flex items-center gap-4 cursor-pointer hover:bg-slate-50">
                            <div class="h-10 w-10 rounded-full text-white flex items-center justify-center shrink-0" style="background-color: var(--tw-primary-color);">
                                <i class="fas fa-link text-lg"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-slate-900">Create call link</h3>
                                <p class="text-sm text-slate-500">Share a link for your BongoWide call</p>
                            </div>
                        </div>

                        <h2 class="text-lg font-semibold text-slate-900 pt-2">Recent</h2>
                        <div class="bg-white p-8 rounded-lg shadow-sm h-32 flex items-center justify-center border border-slate-100">
                            <p class="text-slate-500">No recent calls</p>
                        </div>

                        <h2 class="text-lg font-semibold text-slate-900 pt-2">Start a call</h2>
                        <div class="rounded-lg shadow-sm overflow-hidden divide-y divide-slate-100 border border-slate-100">
                            ${callContactsHtml}
                        </div>

                    </div>
                    
                    <button class="absolute bottom-6 right-6 h-14 w-14 rounded-full shadow-lg text-white flex items-center justify-center transition-transform active:scale-95" style="background-color: var(--tw-primary-color);">
                        <i class="fas fa-phone-alt text-xl"></i>
                    </button>
                </div>
            `;
        }

        // --- 3. APP LOGIC (Switching Tabs) ---

        function switchTab(tabName) {
            const container = document.getElementById('app-content');
            const nav = document.getElementById('app-nav');
            const header = document.getElementById('app-header');
            const navButtons = document.querySelectorAll('.nav-btn');
            
            // Ficha navigation kwa skrini zisizo za App za kawaida (mfano Settings)
            if (tabName === 'Settings') {
                nav.classList.add('hidden');
                header.querySelector('button[onclick="switchTab(\'Settings\')"]').classList.add('hidden'); // Ficha profile button
                container.innerHTML = getSettingsScreen();
                return;
            } else {
                nav.classList.remove('hidden');
                header.querySelector('button[onclick="switchTab(\'Settings\')"]').classList.remove('hidden'); 
            }

            // Update UI Active State for Buttons
            navButtons.forEach(btn => {
                const icon = btn.querySelector('i');
                const isCurrent = btn.id === `nav-${tabName}`;
                
                btn.style.color = isCurrent ? 'var(--tw-primary-color)' : '';

                if(isCurrent) {
                    btn.classList.add('text-blue-600');
                    btn.classList.remove('text-slate-500');
                } else {
                    btn.classList.remove('text-blue-600');
                    btn.classList.add('text-slate-500');
                }
            });

            // Inject Content based on Tab
            switch(tabName) {
                case 'Chats':
                    container.innerHTML = getChatsScreen();
                    break;
                case 'Updates':
                    container.innerHTML = getUpdatesScreen();
                    break;
                case 'Groups':
                    container.innerHTML = getGroupsScreen();
                    break;
                case 'World':
                    container.innerHTML = getWorldScreen();
                    break;
                case 'Calls':
                    container.innerHTML = getCallsScreen();
                    break;
            }
        }


        // --- NEW: THEME LOGIC ---

        function applyTheme() {
            const root = document.documentElement;
            
            // Apply Mode (Dark/Light)
            if (themeConfig.mode === 'dark') {
                root.classList.add('dark');
                document.querySelector('body').classList.remove('text-slate-900');
            } else {
                root.classList.remove('dark');
                document.querySelector('body').classList.add('text-slate-900');
            }
            localStorage.setItem('theme-mode', themeConfig.mode);

            // Apply Color
            const newColor = getColorClass(themeConfig.color);
            root.style.setProperty('--tw-primary-color', newColor);
            localStorage.setItem('theme-color', themeConfig.color);

            // Re-render the current screen to pick up new dynamic colors
            const currentActiveButton = document.querySelector('.nav-btn.text-blue-600');
            if (currentActiveButton && currentActiveButton.id) {
                const tabName = currentActiveButton.id.replace('nav-', '');
                switchTab(tabName);
            } else {
                 // Initialize default chat screen if not active
                 switchTab('Chats');
            }
        }


        // Kazi ya kubadili Mode (Light/Dark)
        function setMode(mode) {
            themeConfig.mode = mode;
            applyTheme();
        }

        // Kazi ya kubadili Rangi
        function setColor(color) {
            themeConfig.color = color;
            applyTheme();
        }

        // Kazi ya kuonyesha/kuficha Theme Modal
        function handleThemeToggle() {
            const modal = document.getElementById('theme-modal');
            const themeBtn = document.getElementById('theme-toggle-btn');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                modal.innerHTML = getThemeModalHtml();
                // Close when clicking outside
                setTimeout(() => { // Tunasubiri ili kuzuia kubonyeza button mara mbili
                    document.addEventListener('click', closeThemeModalOutside);
                }, 0);
            } else {
                modal.classList.add('hidden');
                document.removeEventListener('click', closeThemeModalOutside);
            }
        }

        function closeThemeModalOutside(event) {
            const modal = document.getElementById('theme-modal');
            const themeBtn = document.getElementById('theme-toggle-btn');

            if (!modal.contains(event.target) && !themeBtn.contains(event.target)) {
                modal.classList.add('hidden');
                document.removeEventListener('click', closeThemeModalOutside);
            }
        }

        // HTML kwa ajili ya Theme Modal (Kama picha uliyonitumia)
        function getThemeModalHtml() {
            const colorButtons = colorOptions.map(color => `
                <button 
                    onclick="setColor('${color}'); event.stopPropagation(); handleThemeToggle();" 
                    class="w-8 h-8 rounded-full flex items-center justify-center shadow-md transition-transform active:scale-90"
                    style="background-color: ${getColorClass(color)};"
                >
                    ${themeConfig.color === color ? '<i class="fas fa-check text-white text-xs"></i>' : ''}
                </button>
            `).join('');
            
            // Icon for light mode is Sun (fas fa-sun) and dark mode is Moon (fas fa-moon)
            return `
                <div class="w-64 bg-white dark:bg-black shadow-2xl rounded-lg p-4 border border-slate-200 dark:border-gray-800">
                    <h3 class="font-semibold mb-4 text-slate-900 dark:text-dark-text">Mode</h3>
                    <div class="flex justify-between items-center mb-6">
                        <button onclick="setMode('light'); event.stopPropagation(); handleThemeToggle();" class="flex-1 flex items-center justify-center p-2 rounded-lg transition-colors border ${themeConfig.mode === 'light' ? 'bg-slate-200 dark:bg-gray-700 border-slate-300' : 'hover:bg-slate-100 dark:hover:bg-gray-800 border-transparent'}">
                            <i class="fas fa-sun text-lg mr-2"></i> Light
                        </button>
                        <button onclick="setMode('dark'); event.stopPropagation(); handleThemeToggle();" class="flex-1 flex items-center justify-center p-2 ml-2 rounded-lg transition-colors border ${themeConfig.mode === 'dark' ? 'bg-slate-200 dark:bg-gray-700 border-slate-300' : 'hover:bg-slate-100 dark:hover:bg-gray-800 border-transparent'}">
                            <i class="fas fa-moon text-lg mr-2"></i> Dark
                        </button>
                    </div>

                    <h3 class="font-semibold mb-4 text-slate-900 dark:text-dark-text">Color</h3>
                    <div class="flex justify-between">
                        ${colorButtons}
                    </div>
                </div>
            `;
        }
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            // Apply theme on load
            applyTheme();
            
            // Set the event listener for the theme button
            document.getElementById('theme-toggle-btn').addEventListener('click', (event) => {
                event.stopPropagation();
                handleThemeToggle();
            });

            // Start with Chats Screen
            switchTab('Chats');
        });

    </script>
</body>
</html>